<main class="profile">
    <div class="light top-of-page-light">
        <h1 id="profile">Profile</h1>
        <h2>Welcome to the MFC</h2>
    </div>
<div class="flex-row-stretch">

    <div id='profile-left' class="flex-column-start">

        <div id='profile-options' class='flex-column-start'>

            <h1> Hello, <%= @current_user.username %>.</h1>

            <%= cl_image_tag @current_user.profile_image, alt: @current_user.username, class: 'profile_image' %>

            <h3>What would you like to do?</h3>

            <div class="flex-column-flex-start-align">

                <% if @current_user.present? %>
                    
                    <h4 id='wallet_amount'>Available Funds In Wallet:</h2>
                    <h1 id='wallet_amount_number'><%= @current_user.eth_in_wallet %></h1>

                    <%= button_to "Add Funds", addfunds_path, method: "get", class: "buttonLink", id: "headButton" %>

                    <%= button_to "Edit Account", edit_user_path, method: "get", class: "buttonLink", id: "headButton" %>

                    <%= button_to "Tournaments", tournaments_index_path, method: 'get', class: "buttonLink", id: "headButton" %>

                    <%= button_to "Logout", login_path, method: 'delete', class: "buttonLink", id: "headButton" %>

                    <div id='tournament-widget'>

                        <h1>Join Tournament</h1>
                        <h3><%= @tournament.nfts.count %> / 4</h3>

                        <%# Project TournamentLogic - change this back to how it was after testing %>
                        <% if @tournament.nfts.where(user_id:@current_user.id).count <= 16 %>
                            <%= button_to 'Bet 0.2 ETH', nfts_tournament_path, method: 'get', class: "tournament-button" %>
                        <!-->
                        <% else %>
                            <h3>Please wait. The max is 2 fighters per player.</h3>
                        -->
                        <% end %> 

                        <% if @tournament.nfts.where(user_id:@current_user.id).count >= 1 %>
                        <br>
                            <% if @tournament.nfts.where(user_id:@current_user.id).count == 1 %>
                                <h3>You have <%= @tournament.nfts.where(user_id:@current_user.id).count %> fighter registered.</h3>
                            <% else %>
                                <h3>You have <%= @tournament.nfts.where(user_id:@current_user.id).count %> fighters registered.</h3>
                            <% end %>
                        <% end %>

                    </div>

                    <h1 id='tournament_button_title'>Recent Tournaments</h1>

                        <%# Need to do this because when I first seed, there are no tournaments so it throws an error %>
                        <% if Tournament.all.count > 1 %>

                            <%# This is going to simply take all tournaments that HAVE results, order them by ID in descending order and then take the top 3 (but this does mean it gets all of the results. Could have used limit which is a smaller DB query but it isn't necessary yet) %>
                            <% Tournament.all.includes(:results).where.not(results:{id:nil}).order([:id]).reverse.take(3).each do |t| %>
                                <%= tournament_id = t.id %>
                                <%= button_to 'Watch', tournament_path(t.id), method: 'get', class: "recent_tournament_button", id: "recent_tournament_button_id" %>
                            <% end %>

                        <% else %>

                            <h3>There are no tournaments to show.</h3> 

                        <% end %>
            
                <% else %>
            
                    redirect_to login_path
            
                <% end %>

            </div>

        </div>

    </div>

    <div id='profile-right' class="flex-column-start">

        <div id='top-of-asset-grid' class='asset-grid'>

                <div class='asset-id asset-top-row'>
                    <h3>Fighter #</h3>
                </div>

                <div class='asset-id'>
                    <h3>Image</h3>
                </div>

                <div class='asset-id'>
                    <h3>ETH Won</h3>
                </div>      

                <div class='asset-id'>
                    <h3>Fights Won</h3>
                </div>

                <div class='asset-id'>
                    <h3>Fight</h3>
                </div>



            <% @user.nfts.order([:fights_won]).reverse.each do |nft| %>

                <div class='asset-id'>
                    <h3>#<%= link_to nft.id, nft_path(nft.id)  %></h3>
                </div>

                <div class='asset-id'>
                    <%= link_to image_tag(nft.image, class: "profile_asset_image"), nft_path(nft.id) %>
                </div>

                <div class='asset-id'>
                    <h3><%= link_to nft.amount_won, nft_path(nft.id)  %></h3>
                </div>

                <div class='asset-id'>
                    <h3><%= link_to nft.wins, nft_path(nft.id)  %></h3>
                </div>

                <div class='asset-id'>
                    <h3><%= button_to 'Fight', fight_path(nft.id), method:'get', class: "buttonLink", id: "fightButton" %></h3>
                </div>

            <% end %>

        </div>

            <% if @user.nfts.all.count == 0 %>
                <div id='no-nfts-mint-section-under-table'>
                    <h1>You have no fighters!</h1>
                    <h3>Mint one now.</h3>
                    <%= button_to "Mint A Fighter", nfts_mint_path, method:'get', class: "buttonLink", id: "headButton" %>
                </div>

            <% end %>        

    </div>

</div>


</main>

